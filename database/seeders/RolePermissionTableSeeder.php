<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace Database\Seeders;

	// Laravel
	use Illuminate\Database\Seeder;

	// Models
	use Spatie\Permission\Models\Role;
	use Spatie\Permission\Models\Permission;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CLASS
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class RolePermissionTableSeeder extends Seeder
{



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	RUN
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function run(): void {

		// Reset cached roles and permissions
		app()[\Spatie\Permission\PermissionRegistrar::class]->forgetCachedPermissions();

		$this->createPermissions();
		$this->createRoles();
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	PERMISSIONS
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	protected function createPermissions(): void {

		// File Manager
		Permission::findOrCreate('create files');
		Permission::findOrCreate('edit files');
		Permission::findOrCreate('delete files');
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	ROLES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	protected function createRoles(): void {

		// guest (no permissions)
		Role::findOrCreate('guest');

		// default user
		$user = Role::findOrCreate('user');
		$user->givePermissionTo(['create files', 'edit files', 'delete files']);

		// default subscription member
		$member = Role::findOrCreate('member');
		$member->givePermissionTo(['create files', 'edit files', 'delete files']);

		// default backend user
		$editor = Role::findOrCreate('editor');
		$editor->givePermissionTo(['create files', 'edit files', 'delete files']);

		// admin
		$admin = Role::findOrCreate('admin');
		$admin->givePermissionTo(Permission::all());
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end class
