<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	// Laravel
	use Illuminate\Support\Facades\Route;

	// App
	use App\Http\Controllers\App\Shop\StripeSubscriptionController;
	use App\Http\Controllers\App\Shop\ProductController;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	SHOP PUBLIC
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	Route::get('/product', [ProductController::class,'getPublicList'])->name('api.product.list');
	Route::get('/product/{slug}', [ProductController::class,'getPublicBySlug'])->name('api.product');



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	SHOP PROTECTED
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	Route::group(['middleware'=>'auth:sanctum'],function(){

		$subscriptions = array_keys(config('cashier.subscription'));

		// Paid content
		Route::get('product/{slug}/paid', [ProductController::class,'getPaidBySlug'])->name('api.product.paid');

		// Stripe
		Route::post('stripe/subscription', [StripeSubscriptionController::class,'get'])->name('api.stripe.subscription');
		Route::post('stripe/subscription/cancel', [StripeSubscriptionController::class,'cancelSubscription'])->whereIn('type', $subscriptions)->name('api.stripe.subscription.cancel');
		Route::post('stripe/subscription/resume', [StripeSubscriptionController::class, 'resumeSubscription'])->whereIn('type', $subscriptions)->name('api.stripe.subscription.resume');
		Route::post('stripe/payment/secret', [StripeSubscriptionController::class,'getPaymentSecret'])->whereIn('type', $subscriptions)->name('api.stripe.payment.secret')->middleware('throttle:critical');
	});


