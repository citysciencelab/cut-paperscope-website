<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace Tests\PHPUnit\Feature\Http\Controllers\Backend\Base;

	// Laravel
	use Tests\PHPUnit\TestCase;
	use Illuminate\Foundation\Testing\RefreshDatabase;

	// App
	use App\Models\App\Base\Fragment;
	use App\Models\App\Base\Page;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    CLASS DECLARATION
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class BackendFragmentControllerTest extends TestCase {

	use RefreshDatabase;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	MODEL LIST
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function test_get_model_list_in_backend() {

		// arrange
		$this->seed();
		$this->loginAsAdmin();

		// act
		$data = $this->postData('/api/backend/fragment', [], $this->getBackendHeaders());

		// assert
		$this->assertIsArray($data);
		$this->assertEquals('fragment',$data[0]['type']);
		$this->assertTrue(isset($data[0]['public']));
	}


	public function test_get_child_model_list() {

		// arrange
		$this->seed();
		$this->loginAsAdmin();
		$page = Page::factory()->hasFragments(3)->create();

		// act
		$fragments = $this->getData('/api/backend/fragment/child/'.$page->id, [], $this->getBackendHeaders());

		// assert
		$this->assertIsArray($fragments);
		$this->assertEquals('fragment',$fragments[0]['type']);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	MODEL GET
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function test_get_model_in_backend() {

		// arrange
		$this->loginAsAdmin();
		$fragment = Fragment::factory()->create(['public'=>false]);

		// act
		$data = $this->getData('/api/backend/fragment/'.$fragment->id, [], $this->getBackendHeaders());

		// assert
		$this->assertEquals('fragment',$data['type']);
	}


	public function test_get_model_in_backend_not_found() {

		// arrange
		$this->loginAsAdmin();

		// act and assert
		$this->getError('/api/backend/fragment/3ec9fc3b-a102-40b6-bd61-743f8bd2403b');
	}


	public function test_get_model_in_backend_unauthenticated() {

		// arrange
		$fragment = Fragment::factory()->create(['public'=>false]);

		// act
		$response = $this->getJson('/api/backend/fragment/'.$fragment->id);

		// assert
		$response->assertStatus(401);
		$response->assertJson(['message'=>'Unauthenticated.']);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end class

