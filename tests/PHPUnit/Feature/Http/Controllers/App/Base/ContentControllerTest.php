<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace Tests\PHPUnit\Feature\Http\Controllers\App\Base;

	// Laravel
	use Tests\PHPUnit\TestCase;
	use Illuminate\Foundation\Testing\RefreshDatabase;
	use Illuminate\Support\Facades\Mail;

	// App
	use App\Mail\ContactMail;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    CLASS DECLARATION
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class ContentControllerTest extends TestCase {

	use RefreshDatabase;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	DATA
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function test_get_content() {

		// arrange
		$this->seed();

		// act
		$content = $this->getData('/api/content');

		// assert
		$this->assertIsArray($content['settings']);
		$this->assertIsArray($content['pages']);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CONTACT FORM
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function test_contact_mail_address() {

		$this->assertNotEmpty(config('mail.contact'));
	}


	public function test_contact_mail_content() {

		// arrange
		$mail = new ContactMail([
			'message' => 	'Test message',
			'name' => 		'Max Mustermann',
			'email' => 		'max@mustermann.de'
		]);

		// assert
		$mail->assertSeeInHtml('Test message');
	}


	public function test_sending_contact_mail() {

		// arrange
		Mail::fake();

		// act: send contact form
		$response = $this->post('/api/contact', [
			'message' => 	'Test message',
			'name' => 		'Max Mustermann',
			'email' => 		'max@mustermann.de',
		]);

		// assert: response with success
		$response->assertJson(['status' => 'success']);

		// assert: mail was sent
		Mail::assertQueued(ContactMail::class, function ($mail) {
			return $mail->hasTo(config('mail.contact'));
		});
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end class

