<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace App\Listeners;

	// Laravel
	use Illuminate\Auth\Events\Verified;

	// App
	use App\Jobs\Newsletter\AddUserToNewsletter;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CLASS DECLARATION
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class VerifiedUserListener
{

	public function __construct() {

	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	HANDLE
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function handle(Verified $event) {

		/** @var App\Models\Auth\User $user **/
		$user = $event->user;

		$user->changeRole('guest', $user->subscribed('default') ? 'member' : 'user');

		// add user to Brevo Newsletter
		if($user->newsletter) { AddUserToNewsletter::dispatch($user, false); }
	}



/*/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


}
