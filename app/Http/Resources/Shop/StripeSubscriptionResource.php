<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace App\Http\Resources\Shop;

	// Laravel
	use Illuminate\Http\Resources\Json\JsonResource;

	// App
	use App\Http\Resources\Shop\StripeInvoiceResource;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CLASS
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class StripeSubscriptionResource extends JsonResource {


	public function toArray($request): array {

		if($this->type != 'free') {
			$price = number_format($this->plan->amount/100, 2, ',', '.' ) . ' ' . strtoupper($this->plan->currency);
		}
		else {
			$price = 'Free';
		}

		return [

			'type' => 	'stripe_subscription',
			'name' => 	$this->type,
			'price' => 	$price,

			'current_period_end' => $this->current_period_end,
			'status' => 			$this->status ?? $this->stripe_status,
			'charge_automatic' => 	$this->collection_method == 'charge_automatically',

			'cancel_at' => 		$this->cancel_at,
			'ended_at' => 		$this->ended_at,
			"trial_start" => 	$this->trial_start,
			"trial_end" => 		$this->trial_end,

			'invoices' => 		$this->type == 'free' ? [] : StripeInvoiceResource::collection($this->invoices),
		];
	}



/*/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


}
