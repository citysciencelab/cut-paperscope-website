<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace App\Http\Middleware;

	// Laravel
	use Illuminate\Cookie\Middleware\EncryptCookies as Middleware;
	use Illuminate\Contracts\Encryption\Encrypter as EncrypterContract;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CLASS CONSTRUCT
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class EncryptCookies extends Middleware {


	// The names of the cookies that should not be encrypted.
	protected $except = [

	];


	public function __construct(EncrypterContract $encrypter) {

		$except = [];

		// Frontend cookies must be excluded from encryption. config() is first available in constructor.
		$cookie = config('cookie-consent.cookie_name');

		// create full cookie name from each category
		foreach(config('cookie-consent.cookie_categories') as $category) {
			array_push($except, $cookie.'_'.$category);
		}

		$this->except = $except;

		parent::__construct($encrypter);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end class
