<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// 	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace App\Http\Requests\Auth;

	// Laravel
	use Illuminate\Support\Facades\Auth;

	// App
	use App\Actions\Fortify\PasswordValidationRules;
	use App\Http\Requests\BaseFormRequest;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// 	CLASS CONSTRUCT
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class PasswordUpdateRequest extends BaseFormRequest {

	// Traits
	use PasswordValidationRules;


	public function authorize(): bool {

		$user = Auth::user();
		return $user && $user->hasPermissionTo('edit users');
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	VALIDATE
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function rules(): array {

		return [

			'id' => 		'required|uuid|exists:users',
			'old' => 		'required|string|current_password',
			'password' => 	$this->passwordRules(),
		];
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	ERROR MESSAGES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	// rename variables for form error messages
	public function attributes(): array {

		return [
			...parent::attributes(),
			'old' => 		trans('Altes Passwort'),
			'password' => 	trans('Neues Passwort'),
		];
	}


	public function messages(): array {

		return [
			...parent::messages(),
			'password.unique' => __('auth.password-insecure'),
		];
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end class
