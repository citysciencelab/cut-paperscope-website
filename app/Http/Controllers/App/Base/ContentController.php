<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace App\Http\Controllers\App\Base;

	// Laravel
	use App\Http\Controllers\App\AppController;
	use Illuminate\Support\Facades\Mail;
	use Illuminate\Support\Facades\Cache;
	use Illuminate\Http\JsonResponse;

	// App
	use App\Http\Requests\App\Base\ContactRequest;
	use App\Mail\ContactMail;

	// App resources
	use App\Http\Resources\Base\SettingListResource;
	use App\Http\Resources\Base\PageListResource;

	// App requests
	use App\Http\Requests\App\Base\ListWithFilterRequest;

	// App models



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CLASS CONSTRUCT
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class ContentController extends AppController {



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CONTENT
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function getPublicContent(ListWithFilterRequest $request): JsonResponse {

		// cache content based on active language
		$cacheKey = 'content_' . app()->getLocale();

		// get static data
		$data = Cache::rememberForever($cacheKey, function () use ($request) {

			return [
				'settings' => SettingListResource::collection( (new SettingController())->loadPublicList($request) ),
			];
		});

		// get live data
		$data['pages'] = PageListResource::collection( (new PageController())->loadPublicList($request) );

		return $this->responseData($data);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	CONTACT FORM
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function contact(ContactRequest $request): JsonResponse {

		$validated = $request->validated();

		$contact = [
			'message' => $validated->message,
			'name' => $validated->name,
			'email' => $validated->email,
		];

		// Send mail
		Mail::to(config('mail.contact'))->queue(new ContactMail($contact));	// using queue
		//Mail::to(config('mail.contact'))->send(new ContactMail($contact));	// direct execution

		// response for user
		return $this->responseSuccess();
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end class
