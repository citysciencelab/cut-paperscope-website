///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	ARTISAN
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# update single migration
php artisan migrate:rollback --path=database/migrations/2021_01_02_000000_create_items_table.php && php artisan migrate

# revert last migration
php artisan migrate:rollback --step=1

# test only one file with phpunit
php artisan test --filter=BackendControllerTest --config=./tests/PHPUnit/phpunit.xml



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	MISC
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


mklink /D "C:\xampp\htdocs\hcu\paperscope-website\public\storage" "C:\xampp\htdocs\hcu\paperscope-website\storage\app\public"



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	SUPERVISORCTL
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# reread all files in config.d folder (for new configfile)
sudo supervisorctl reread

# update internal list of availables configfiles
sudo supervisorctl update

# start a new process
sudo supervisorctl start hn-website-queue:*



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	IMAGES
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# convert image to webp https://developers.google.com/speed/webp/docs/cwebp
cwebp -preset photo -q 80 image.png -o image.webp



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	AWS
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# sync folder from s3 to local
aws s3 sync --profile _AWS_PROFILENAME_ s3://_BUCKET_NAME_/videos/2021-08/hrJpdfulaL ./videos/2021-08/hrJpdfulaL

# sync folder from local to s3
aws s3 sync --profile _AWS_PROFILENAME_ videos/2021-08/hrJpdfulaL s3://BUCKET_NAME_/videos/2021-08/hrJpdfulaL



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	STRIPE
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# start a local listener for development
stripe listen --forward-to localhost/femmecapital/website/public/stripe/webhook



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	MEILISEARCH
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# update meilisearch database with model
php artisan scout:import "App\Models\Auth\User"

# update after index changes in config
php artisan scout:sync-index-settings

# get settings for index (app name with model table)
curl -X GET 'http://localhost:7700/indexes/laravel-starter-videos/settings' -H 'Authorization: Bearer _MASTER_KEY_'

# set order of searchable properties
curl -X POST 'http://localhost:7700/indexes/laravel-starter-videos/settings' -H 'Content-Type: application/json' -H 'Authorization: Bearer _MASTER_KEY_' --data-binary '{"searchableAttributes": ["search_keywords", "title", "social_description"]}'



///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//	SSH
//
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


# copy storage from remote
scp -r -P 7768 -i ~/.ssh/hn_website nasty@hello-nasty.com:/var/www/vhosts/hello-nasty.com/subdomains/dev.hello-nasty.com/projects/hello-nasty/website/storage/app/public ~/Downloads

# copy storage to remote
scp -r -P 7768 -i ~/.ssh/hn_website ~/Downloads/public nasty@hello-nasty.com:/var/www/vhosts/hello-nasty.com/subdomains/dev.hello-nasty.com/projects/hello-nasty/website/storage/app

# add scheduler to cron (as root)
crontab -e
* * * * * cd /var/www/vhosts/hello-nasty.com/projects/website && /opt/plesk/php/8.2/bin/php artisan schedule:run >> /dev/null 2>&1
