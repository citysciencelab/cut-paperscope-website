<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	namespace Tests\PHPUnit\Feature\Http\Requests\Backend;

	// Laravel
	use Tests\PHPUnit\TestCase;
	use Illuminate\Foundation\Testing\RefreshDatabase;
	use Illuminate\Support\Facades\Bus;

	// App
	use App\Jobs\Process{{ModelClass}}Upload;
	{{includesApp}}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    CLASS DECLARATION
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


class {{ModelClass}}SaveRequestTest extends TestCase {

	use RefreshDatabase;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    SAVE
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	public function test_save_{{slug}}() {

		// arrange
		Bus::fake();
		$this->loginAsEditor();

		// arrange: form data
		$formData = $this->getBaseFormData();
{{attributes}}
{{relations}}

		// act
		${{slug}} = $this->postData('/api/backend/{{slug}}/save', $formData, $this->getBackendHeaders());

		// assert
		$this->assertEquals('{{slug}}',${{slug}}['type']);
		$this->assertArraySubset($formData, ${{slug}});
		{{assertRelations}}

		// assert: jobs
		Bus::assertDispatched(Process{{ModelClass}}Upload::class);
		{{assertJobs}}
	}


	private function getBaseFormData() {

		return [
			'name' => 'test name',
			'slug' => 'test-slug',
			'public' => true,
			'order' => 0,
			'published_start' => '1.2.2023 12:34',
		];
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */

} // end class

