<?php
/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	// laravel
	require_once __DIR__ . '/../../../../vendor/autoload.php';
	use Illuminate\Support\Str;



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    MAIN
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


trait CreateAppController {



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    APP CONTROLLER
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	protected function createAppController() {

		if($this->userInput['target'] == 'fragment') { return; }

		$this->fillTemplate('TemplateController.php', 'app/Http/Controllers/App/'.$this->userInput['name'].'Controller.php', function($template) {

			$this->replace($template, '{{relations}}', $this->createAppControllerRelations());
			$this->replaceLine($template, '{{includesLaravel}}', $this->createAppControllerIncludesLaravel());
			$this->replaceLine($template, '{{includesApp}}', $this->createAppControllerIncludesApp());

			return $template;
		});
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    RELATIONS
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	protected function createAppControllerRelations() {

		$relations = "";

		foreach($this->userInput['relations'] as $r) {

			if($r['type'] == 'hasOne') {

				$relations .= "'".$r['slug']."',";
			}
			else if($r['type'] == 'belongsToMany') {

				$relations .= "'".Str::plural($r['slug'])."',";
			}
			else if($r['type'] == 'childRelation') {

				$relations .= "'".Str::plural($r['slug'])."',";
			}
		}

		return Str::replaceLast(',', '', $relations);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    INCLUDES
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


	protected function createAppControllerIncludesLaravel() {

		$includes = "";

		if($this->userInput['target'] == 'page') {
			$includes .= "use Illuminate\Support\Facades\Cache;\n\t";
			$includes .= "use Illuminate\Http\JsonResponse;\n\t";
		}

		return Str::replaceLast("\n\t", '', $includes);
	}


	protected function createAppControllerIncludesApp() {

		$includes = "";

		if($this->userInput['target'] == 'page') {
			$includes .= "use App\Http\Requests\App\Base\ListWithFilterRequest;\n\t";
		}

		return Str::replaceLast("\n\t", '', $includes);
	}



/*///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// */


} // end trait
